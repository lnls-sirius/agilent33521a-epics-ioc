record(bo, "$(P)$(R)ChanOut-Sel") {
    field(DESC, "Enable channel output")
    field(PINI, "YES")
    field(ZNAM, "OFF")
    field(ONAM, "ON")
    field(DTYP, "stream")
    field(OUT, "@agilent33521a.proto channelOutputEnable $(PORT)")
    field(FLNK, "$(P)$(R)ChanOut-Sts")
}

record(bi, "$(P)$(R)ChanOut-Sts") {
    field(DESC, "Read channel output status")
    field(ZNAM, "OFF")
    field(ONAM, "ON")
    field(DTYP, "stream")
    field(INP, "@agilent33521a.proto channelOutputRead $(PORT)")
}

record(mbbi, "$(P)$(R)WfmFunction-Sts") {
    field(DESC, "Read current waveform function")
    field(ZRST, "Sine")
    field(ONST, "Square")
    field(TWST, "Triangle")
    field(THST, "Ramp")
    field(FRST, "Pulse")
    field(FVST, "Pseudo-random Bit Stream")
    field(SXST, "Noise")
    field(SVST, "Arbitrary")
    field(EIST, "DC")
    field(DTYP, "stream")
    field(INP, "@agilent33521a.proto getWaveformFunction $(PORT)")
}

record(mbbo, "$(P)$(R)WfmFunction-Sel") {
    field(DESC, "Select waveform function")
    field(PINI, "YES")
    field(ZRST, "Sine")
    field(ONST, "Square")
    field(TWST, "Triangle")
    field(THST, "Ramp")
    field(FRST, "Pulse")
    field(FVST, "Pseudo-random Bit Stream")
    field(SXST, "Noise")
    field(SVST, "Arbitrary")
    field(EIST, "DC")
    field(DTYP, "stream")
    field(OUT, "@agilent33521a.proto setWaveformFunction $(PORT)")
    field(FLNK, "$(P)$(R)WfmFunction-Sts")
}

record(ai, "$(P)$(R)Freq-RB") {
    field(DESC, "Read configured frequency")
    field(EGU, "Hz")
    field(DTYP, "stream")
    field(PREC, "6")
    field(INP, "@agilent33521a.proto getFrequency $(PORT)")
}

record(ao, "$(P)$(R)Freq-SP") {
    field(DESC, "Configure frequency value")
    field(PINI, "YES")
    field(EGU, "Hz")
    field(DTYP, "stream")
    field(DRVH, "30000000")
    field(DRVL, "0.000001")
    field(PREC, "6")
    field(OUT, "@agilent33521a.proto setFrequency $(PORT)")
    field(FLNK, "$(P)$(R)Freq-RB")
}

record(ai, "$(P)$(R)FreqStart-RB") {
    field(DESC, "Read configured start frequency")
    field(EGU, "Hz")
    field(DTYP, "stream")
    field(PREC, "6")
    field(INP, "@agilent33521a.proto getFrequencyStart $(PORT)")
}

record(ao, "$(P)$(R)FreqStart-SP") {
    field(DESC, "Configure start frequency value")
    field(PINI, "YES")
    field(EGU, "Hz")
    field(DTYP, "stream")
    field(DRVH, "30000000")
    field(DRVL, "0.000001")
    field(PREC, "6")
    field(OUT, "@agilent33521a.proto setFrequencyStart $(PORT)")
    field(FLNK, "$(P)$(R)FreqStart-RB")
}

record(ai, "$(P)$(R)FreqStop-RB") {
    field(DESC, "Read configured stop frequency")
    field(EGU, "Hz")
    field(DTYP, "stream")
    field(PREC, "6")
    field(INP, "@agilent33521a.proto getFrequencyStop $(PORT)")
}

record(ao, "$(P)$(R)FreqStop-SP") {
    field(DESC, "Configure stop frequency value")
    field(PINI, "YES")
    field(EGU, "Hz")
    field(DTYP, "stream")
    field(DRVH, "30000000")
    field(DRVL, "0.000001")
    field(PREC, "6")
    field(OUT, "@agilent33521a.proto setFrequencyStop $(PORT)")
    field(FLNK, "$(P)$(R)FreqStop-RB")
}

record(ai, "$(P)$(R)SweepTime-RB") {
    field(DESC, "Read configured sweep time")
    field(EGU, "s")
    field(DTYP, "stream")
    field(PREC, "3")
    field(INP, "@agilent33521a.proto getSweepTime $(PORT)")
}

record(ao, "$(P)$(R)SweepTime-SP") {
    field(DESC, "Configure sweep time value")
    field(PINI, "YES")
    field(EGU, "s")
    field(DTYP, "stream")
    field(DRVH, "250000")
    field(DRVL, "0.001")
    field(PREC, "3")
    field(OUT, "@agilent33521a.proto setSweepTime $(PORT)")
    field(FLNK, "$(P)$(R)SweepTime-RB")
}

record(ai, "$(P)$(R)SweepHTime-RB") {
    field(DESC, "Read configured sweep hold time")
    field(EGU, "s")
    field(DTYP, "stream")
    field(PREC, "3")
    field(INP, "@agilent33521a.proto getSweepHTime $(PORT)")
}

record(ao, "$(P)$(R)SweepHTime-SP") {
    field(DESC, "Configure sweep hold time value")
    field(PINI, "YES")
    field(EGU, "s")
    field(DTYP, "stream")
    field(DRVH, "3600")
    field(DRVL, "0.001")
    field(PREC, "3")
    field(OUT, "@agilent33521a.proto setSweepHTime $(PORT)")
    field(FLNK, "$(P)$(R)SweepHTime-RB")
}

record(ai, "$(P)$(R)SweepRTime-RB") {
    field(DESC, "Read configured sweep return time")
    field(EGU, "s")
    field(DTYP, "stream")
    field(PREC, "3")
    field(INP, "@agilent33521a.proto getSweepRTime $(PORT)")
}

record(ao, "$(P)$(R)SweepRTime-SP") {
    field(DESC, "Configure sweep return time value")
    field(PINI, "YES")
    field(EGU, "s")
    field(DTYP, "stream")
    field(DRVH, "3600")
    field(DRVL, "0.001")
    field(PREC, "3")
    field(OUT, "@agilent33521a.proto setSweepRTime $(PORT)")
    field(FLNK, "$(P)$(R)SweepRTime-RB")
}

record(bo, "$(P)$(R)SweepState-Sel") {
    field(DESC, "Set sweep state")
    field(PINI, "YES")
    field(ZNAM, "OFF")
    field(ONAM, "ON")
    field(DTYP, "stream")
    field(OUT, "@agilent33521a.proto setSweepState $(PORT)")
    field(FLNK, "$(P)$(R)SweepState-Sts")
}

record(bi, "$(P)$(R)SweepState-Sts") {
    field(DESC, "Read sweep state")
    field(ZNAM, "OFF")
    field(ONAM, "ON")
    field(DTYP, "stream")
    field(INP, "@agilent33521a.proto getSweepState $(PORT)")
}

record(mbbi, "$(P)$(R)SweepSpacing-Sts") {
    field(DESC, "Read current sweep spacing")
    field(ZRST, "LIN")
    field(ONST, "LOG")
    field(DTYP, "stream")
    field(INP, "@agilent33521a.proto getSweepSpacing $(PORT)")
}

record(mbbo, "$(P)$(R)SweepSpacing-Sel") {
    field(DESC, "Select sweep spacing")
    field(PINI, "YES")
    field(ZRST, "LIN")
    field(ONST, "LOG")
    field(DTYP, "stream")
    field(OUT, "@agilent33521a.proto setSweepSpacing $(PORT)")
    field(FLNK, "$(P)$(R)SweepSpacing-Sts")
}

record(ai, "$(P)$(R)Ampl-RB") {
    field(DESC, "Read configured amplitude")
    field(EGU, "V")
    field(DTYP, "stream")
    field(PREC, "3")
    field(INP, "@agilent33521a.proto getAmplitude $(PORT)")
}

record(ao, "$(P)$(R)Ampl-SP") {
    field(DESC, "Configure amplitude value")
    field(PINI, "YES")
    field(EGU, "V")
    field(DTYP, "stream")
    field(DRVH, "10")    # For 50 ohm, range is -5V to 5V
    field(DRVL, "-10")
    field(PREC, "3")
    field(OUT, "@agilent33521a.proto setAmplitude $(PORT)")
    field(FLNK, "$(P)$(R)Ampl-RB")
}

record(ai, "$(P)$(R)Offset-RB") {
    field(DESC, "Read configured DC offset")
    field(EGU, "V")
    field(DTYP, "stream")
    field(PREC, "3")
    field(INP, "@agilent33521a.proto getOffset $(PORT)")
}

record(ao, "$(P)$(R)Offset-SP") {
    field(DESC, "Configure DC offset")
    field(PINI, "YES")
    field(EGU, "V")
    field(DTYP, "stream")
    field(DRVH, "10")    # For 50 ohm, range is -5V to 5V
    field(DRVL, "-10")
    field(PREC, "3")
    field(OUT, "@agilent33521a.proto setOffset $(PORT)")
    field(FLNK, "$(P)$(R)Offset-RB")
}

record(ai, "$(P)$(R)Phs-RB") {
    field(DESC, "Read configured phase")
    field(EGU, "degrees")
    field(DTYP, "stream")
    field(PREC, "3")
    field(INP, "@agilent33521a.proto getPhase $(PORT)")
}

record(ao, "$(P)$(R)Phs-SP") {
    field(DESC, "Configure phase")
    field(PINI, "YES")
    field(EGU, "degrees")
    field(DTYP, "stream")
    field(DRVH, "360")
    field(DRVL, "-360")
    field(PREC, "3")
    field(OUT, "@agilent33521a.proto setPhase $(PORT)")
    field(FLNK, "$(P)$(R)Phs-RB")
}

record(ai, "$(P)$(R)SquareDutyCycle-RB") {
    field(DESC, "Read configured square wave duty cycle")
    field(EGU, "%")
    field(DTYP, "stream")
    field(PREC, "2")
    field(INP, "@agilent33521a.proto getSquareDutyCycle $(PORT)")
}

record(ao, "$(P)$(R)SquareDutyCycle-SP") {
    field(DESC, "Configure square wave duty cycle")
    field(PINI, "YES")
    field(EGU, "%")
    field(DTYP, "stream")
    field(DRVH, "99.99")    # Limits become more restrict as frequency increases
    field(DRVL, "0.01")
    field(PREC, "2")
    field(OUT, "@agilent33521a.proto setSquareDutyCycle $(PORT)")
    field(FLNK, "$(P)$(R)SquareDutyCycle-RB")
}

record(ai, "$(P)$(R)RmpSymmetry-RB") {
    field(DESC, "Read configured ramp function symmetry")
    field(EGU, "%")
    field(DTYP, "stream")
    field(PREC, "2")
    field(INP, "@agilent33521a.proto getRampSymmetry $(PORT)")
}

record(ao, "$(P)$(R)RmpSymmetry-SP") {
    field(DESC, "Configure ramp function symmetry")
    field(PINI, "YES")
    field(EGU, "%")
    field(DTYP, "stream")
    field(DRVH, "100")
    field(DRVL, "0")
    field(PREC, "2")
    field(OUT, "@agilent33521a.proto setRampSymmetry $(PORT)")
    field(FLNK, "$(P)$(R)RmpSymmetry-RB")
}

record(ai, "$(P)$(R)PulseWidth-RB") {
    field(DESC, "Read configured pulse width")
    field(EGU, "s")
    field(DTYP, "stream")
    field(PREC, "9")
    field(INP, "@agilent33521a.proto getPulseWidth $(PORT)")
}

record(ao, "$(P)$(R)PulseWidth-SP") {
    field(DESC, "Configure pulse width")
    field(PINI, "YES")
    field(EGU, "s")
    field(DTYP, "stream")
    field(DRVH, "1000000")    # Depends on period used
    field(DRVL, "0.000000016")
    field(PREC, "9")
    field(OUT, "@agilent33521a.proto setPulseWidth $(PORT)")
    field(FLNK, "$(P)$(R)PulseWidth-RB")
}

record(ai, "$(P)$(R)PulseLeadingEdge-RB") {
    field(DESC, "Read configured leading edge time")
    field(EGU, "s")
    field(DTYP, "stream")
    field(PREC, "10")
    field(INP, "@agilent33521a.proto getPulseLeadingEdge $(PORT)")
}

record(ao, "$(P)$(R)PulseLeadingEdge-SP") {
    field(DESC, "Configure pulse leading edge time")
    field(PINI, "YES")
    field(EGU, "s")
    field(DTYP, "stream")
    field(DRVH, "0.000001")    # Depends on pulse width and period
    field(DRVL, "0.0000000084")
    field(PREC, "10")
    field(OUT, "@agilent33521a.proto setPulseLeadingEdge $(PORT)")
    field(FLNK, "$(P)$(R)PulseLeadingEdge-RB")
}

record(ai, "$(P)$(R)PulseTrailingEdge-RB") {
    field(DESC, "Read configured trailing edge time")
    field(EGU, "s")
    field(DTYP, "stream")
    field(PREC, "10")
    field(INP, "@agilent33521a.proto getPulseTrailingEdge $(PORT)")
}

record(ao, "$(P)$(R)PulseTrailingEdge-SP") {
    field(DESC, "Configure pulse trailing edge time")
    field(PINI, "YES")
    field(EGU, "s")
    field(DTYP, "stream")
    field(DRVH, "0.000001")    # Depends on pulse width and period
    field(DRVL, "0.0000000084")
    field(PREC, "10")
    field(OUT, "@agilent33521a.proto setPulseTrailingEdge $(PORT)")
    field(FLNK, "$(P)$(R)PulseTrailingEdge-RB")
}

record(ai, "$(P)$(R)PRBSBitRate-RB") {
    field(DESC, "Read configured PRBS bit rate")
    field(EGU, "bps")
    field(DTYP, "stream")
    field(PREC, "3")
    field(INP, "@agilent33521a.proto getPrbsBitRate $(PORT)")
}

record(ao, "$(P)$(R)PRBSBitRate-SP") {
    field(DESC, "Configure PRBS bit rate")
    field(PINI, "YES")
    field(EGU, "s")
    field(DTYP, "stream")
    field(DRVH, "50000000")
    field(DRVL, "0.001")
    field(PREC, "3")
    field(OUT, "@agilent33521a.proto setPrbsBitRate $(PORT)")
    field(FLNK, "$(P)$(R)PRBSBitRate-RB")
}

record(ai, "$(P)$(R)PRBSEdgeTime-RB") {
    field(DESC, "Read configured PRBS edge time")
    field(EGU, "s")
    field(DTYP, "stream")
    field(PREC, "10")
    field(INP, "@agilent33521a.proto getPrbsEdgeTime $(PORT)")
}

record(ao, "$(P)$(R)PRBSEdgeTime-SP") {
    field(DESC, "Configure PRBS edge time")
    field(PINI, "YES")
    field(EGU, "s")
    field(DTYP, "stream")
    field(DRVH, "0.000001")    # Depends on pulse width and period
    field(DRVL, "0.0000000084")
    field(PREC, "10")
    field(OUT, "@agilent33521a.proto setPrbsEdgeTime $(PORT)")
    field(FLNK, "$(P)$(R)PRBSEdgeTime-RB")
}

record(mbbi, "$(P)$(R)PRBSSeqType-Sts") {
    field(DESC, "Read current PRBS sequence type")
    field(ZRST, "PN7")
    field(ONST, "PN9")
    field(TWST, "PN11")
    field(THST, "PN15")
    field(FRST, "PN20")
    field(FVST, "PN23")
    field(DTYP, "stream")
    field(INP, "@agilent33521a.proto getPrbsSequenceType $(PORT)")
}

record(mbbo, "$(P)$(R)PRBSSeqType-Sel") {
    field(DESC, "Select PRBS sequence type")
    field(PINI, "YES")
    field(ZRST, "PN7")
    field(ONST, "PN9")
    field(TWST, "PN11")
    field(THST, "PN15")
    field(FRST, "PN20")
    field(FVST, "PN23")
    field(DTYP, "stream")
    field(OUT, "@agilent33521a.proto setPrbsSequenceType $(PORT)")
    field(FLNK, "$(P)$(R)PRBSSeqType-Sts")
}

record(ai, "$(P)$(R)NoiseBw-RB") {
    field(DESC, "Read configured noise function bandwidth")
    field(EGU, "Hz")
    field(DTYP, "stream")
    field(PREC, "3")
    field(INP, "@agilent33521a.proto getNoiseBandwidth $(PORT)")
}

record(ao, "$(P)$(R)NoiseBw-SP") {
    field(DESC, "Configure noise function bandwidth")
    field(PINI, "YES")
    field(EGU, "Hz")
    field(DTYP, "stream")
    field(DRVH, "30000000")
    field(DRVL, "0.001")
    field(PREC, "3")
    field(OUT, "@agilent33521a.proto setNoiseBandwidth $(PORT)")
    field(FLNK, "$(P)$(R)NoiseBw-RB")
}

record(ai, "$(P)$(R)ArbitrarySplRate-RB") {
    field(DESC, "Read sample rate for arbitrary waveform")
    field(EGU, "Sa/s")
    field(DTYP, "stream")
    field(PREC, "6")
    field(INP, "@agilent33521a.proto getArbitraryWaveformSampleRate $(PORT)")
}

record(ao, "$(P)$(R)ArbitrarySplRate-SP") {
    field(DESC, "Set sample rate for arbitrary waveform")
    field(PINI, "YES")
    field(EGU, "Sa/s")
    field(DTYP, "stream")
    field(DRVH, "250000000")
    field(DRVL, "0.000001")
    field(PREC, "6")
    field(OUT, "@agilent33521a.proto setArbitraryWaveformSampleRate $(PORT)")
    field(FLNK, "$(P)$(R)ArbitrarySplRate-RB")
}

record(stringin, "$(P)$(R)ArbitraryWfmFile-RB") {
    field(DESC, "Read arbitrary waveform file path")
    field(DTYP, "stream")
    field(INP, "@agilent33521a.proto getArbitraryWaveformFile $(PORT)")
}

# Loads files stored in EEPROM or EXT. MEM. for them to be used. 
# For full paths, single quotes are needed in caput command. Path backslashes need to be escaped:
# Example: caput <PV> 'INT:\\BUILTIN\\CARDIAC.arb' would make this arb available for usage.
record(stringout, "$(P)$(R)ArbitraryLoadWfmFile-Cmd") {
    field(DESC, "Load arbitrary waveform file into memory")
    field(DTYP, "stream")
    field(OUT, "@agilent33521a.proto loadArbitraryWaveformFile $(PORT)")
}

record(stringout, "$(P)$(R)ArbitraryWfmFile-SP") {
    field(DESC, "Select arbitrary waveform file from path")
    field(PINI, "YES")
    field(DTYP, "stream")
    field(OUT, "@agilent33521a.proto setArbitraryWaveformFile $(PORT)")
    field(FLNK, "$(P)$(R)ArbitraryWfmFile-RB")
}

# For this PV, the expected usage is "caput <PV> <numberOfPoints+1> <filename> <value1> <value2> <value3> ..."
# The protocol file will send data in a comma separated list, as specified from the device's manual
record(waveform, "$(P)$(R)ArbitraryLoadWfmData-Cmd") {
    field(DESC, "Load arbitrary waveform data from array")
    field(NELM, 4096)
    field(FTVL, "STRING")
    field(DTYP, "stream")
    field(INP, "@agilent33521a.proto loadArbitraryWaveformData $(PORT)")
}

# For this PV, the full path to be stored need to be provided: "caput <PV> 'INT:\\mywfm.arb'"
record(stringout, "$(P)$(R)ArbitraryStoreWfmFile-Cmd") {
    field(DESC, "Store current waveform file into non-volatile mem.")
    field(DTYP, "stream")
    field(OUT, "@agilent33521a.proto storeArbitraryWaveformFile $(PORT)")
}

record(bo, "$(P)$(R)ClearMemory-Cmd") {
    field(DESC, "Clear volatile memory")
    field(ZNAM, "NOW")
    field(DTYP, "stream")
    field(OUT, "@agilent33521a.proto clearMemory $(PORT)")
    field(FLNK, "$(P)$(R)ArbitraryWfmFile-RB")
}

######################################################################
# Save
# Desc: Save '-Sel' and '-SP' PV values.

record(bo, "$(P)$(R)Save-Cmd"){
  field(DESC, "Save PV values cmd")
  field(ZNAM, "OFF")
  field(ONAM, "ON")
  field(HIGH, "1")
  field(FLNK, "$(P)$(R)SaveTrg")
}

# This PV is monitored by autosave
record(calc, "$(P)$(R)SaveTrg"){
  field(ASG, "Reserved")
  field(DESC, "Save PV values trigger")
  field(INPA, "$(P)$(R)Save-Cmd.VAL")
  field(CALC, "A=1?!VAL:VAL")
  field(VAL, "0")
}
